# sms_sender

Задача

Необходимо разработать сервис управления рассылками.

Описание

Необходимо реализовать методы создания новой рассылки и просмотр созданных рассылок.

Критерии приёмки
- Выполненное задание необходимо разместить в публичном репозитории на github;
- Необходимо использовать Docker для запуска приложения;
- Коллекция Postman для проверки API.

Основное задание

Спроектировать и разработать сервис, который по заданным правилам запускает рассылку по списку клиентов.

Сущность "рассылка" имеет атрибуты:
- уникальный id рассылки;
- дата и время запуска рассылки;
- id сообщения для отправки;
- фильтр свойств клиентов, на которых должна быть произведена рассылка (код мобильного оператора, тег);
- дата и время окончания рассылки: если по каким-то причинам не успели разослать все сообщения - никакие сообщения клиентам после этого времени доставляться не должны

Сущность "клиент" имеет атрибуты:
- уникальный id клиента
- номер телефона клиента в формате 7XXXXXXXXXX (X - цифра от 0 до 9)
- код мобильного оператора
- тег (произвольная метка)
  
Сущность "сообщение" имеет атрибуты:
- уникальный id сообщения
- текст сообщения.

Сущность "отчет" имеет атрибуты:
- уникальный id отчета
- дата и время создания отчета (отправки сообщения)
- текст сообщения.
- номер телефона клиента.
  
Логика рассылки

- После создания новой рассылки, если текущее время больше времени начала и меньше времени окончания - должны быть выбраны из справочника все клиенты, которые подходят под значения фильтра, указанного в этой рассылке и запущена отправка для всех этих клиентов. Для отправки нужно использовать объект сообщения, который прикреплен к рассылке.
- Если создаётся рассылка с временем старта в будущем - отправка должна стартовать автоматически по наступлению этого времени без дополнительных действий со стороны пользователя системы.
Сообщения рассылки можно выводить в консоль приложения.


Для реализации функционала фильтрации по тегу и коду оператора была создана дополнительная сущность "Tag" 
содержащая в себе одно поле для хранения множества всех тегов и кодов оператора добавленных пользователей.
Сущность "Tag" пополняется автоматически при добавлении нового пользователя.


В данной версии номер телефона и текст СМС печатаются в консоль. Но так же реализованна возможность рассылки СМС через сервис SMS Aero.
Для активации рассылки СМС в файле /sender/sms_sender/tasks.py необходимо раскоментировать закомментированные строки.
Переменные SMSAERO_EMAIL и SMSAERO_API_KEY это email и API ключ для аутентификации в сервисе SMS Aero.

Для запуска сервиса СМС рассылок необходимо склонировать к себе на локальную машину данный репозиторий.
в окне терминала в локальной директории с проектом запустить команду:

sudo docker-compose build

после окончания сборки образа запустить команду:

sudo docker-compose up

Находясь в той же локальной директории с проектом открыть новое окно терминала и выполнить команду:

sudo docker exec -i sms_sender_database_1 pg_restore -U dbuser -v -d dbname < ./sender/dump_1.tar

После чего в первом окне терминала остановить все запущенные контейнеры: "Ctrl+C" и снова выполнить команду:

sudo docker-compose up


